window.__require=function t(e,i,s){function n(a,l){if(!i[a]){if(!e[a]){var h=a.split("/");if(h=h[h.length-1],!e[h]){var r="function"==typeof __require&&__require;if(!l&&r)return r(h,!0);if(o)return o(h,!0);throw new Error("Cannot find module '"+a+"'")}a=h}var c=i[a]={exports:{}};e[a][0].call(c.exports,function(t){return n(e[a][1][t]||t)},c,c.exports,t,e,i,s)}return i[a].exports}for(var o="function"==typeof __require&&__require,a=0;a<s.length;a++)n(s[a]);return n}({DataManager:[function(t,e){"use strict";cc._RF.push(e,"6d230WjzGpMpoY8h1MOJbgy","DataManager");var i,s=(i=t("./constants"))&&i.__esModule?i:{default:i};e.exports.loadData=function(){window.gameData={},cc.resources.load("Data/layout",function(t,e){window.gameData.tableLayout=e.json}),cc.resources.load("Data/tiles",function(t,e){window.gameData.tileTypes=e.json}),window.gameData.flowerTheme=~~(Math.random()*s.default.TILE_FLOWER_THEME.length),window.gameData.seasonTheme=~~(Math.random()*s.default.TILE_SEASON_THEME.length)},e.exports.getLayout=function(){return window.gameData.tableLayout},e.exports.getTileTypes=function(){return window.gameData.tileTypes},e.exports.getFlowerTheme=function(){return s.default.TILE_FLOWER_THEME[window.gameData.flowerTheme]},e.exports.getSeasonTheme=function(){return s.default.TILE_SEASON_THEME[window.gameData.seasonTheme]},cc._RF.pop()},{"./constants":"constants"}],IngameSceneCtor:[function(t,e){"use strict";cc._RF.push(e,"09b929JsbZE6LnNEKlAq2xZ","IngameSceneCtor");var i=o(t("./Models/Tile")),s=o(t("./constants")),n=o(t("./Libs/helpers"));function o(t){return t&&t.__esModule?t:{default:t}}var a=t("./DataManager");cc.Class({extends:cc.Component,properties:{},start:function(){this.table=new cc.Node("Table"),this.table.parent=this.node,this.table.setScale(s.default.TABLE_SCALE),this.table.x=s.default.TABLE_OFFSET_X,this.table.y=s.default.TABLE_OFFSET_Y,this.generateTiles()},generateTiles:function(){for(var t=this,e=[],s=0;s<a.getTileTypes().length;s++)for(var n=0;n<4;n++)e.push(s);e.length===a.getLayout().length?(this.tiles=[],a.getLayout().forEach(function(s){var n=~~(Math.random()*e.length),o=e[n];e.splice(n,1);var a=new i.default(t.table,o,s);a.node.on("clicked",t.onTileClicked,t),t.tiles.push(a)}),this.remapTiles()):cc.error("Invalid data")},remapTiles:function(){var t=this;this.mappedTiles={},this.tiles.forEach(function(e){t.mappedTiles[n.default.getMappedKeyFromTile(e)]=e}),this.validTiles=[],this.tiles.forEach(function(e){for(var i=!0,o=0;o<s.default.RELATIVE_TOP_BLOCKING_TILES.length;o++){var a=s.default.RELATIVE_TOP_BLOCKING_TILES[o],l=e.position.x+a[0],h=e.position.y+a[1],r=e.position.z+a[2];if(t.mappedTiles[n.default.getMappedKeyFromPosition(l,h,r)]){i=!1;break}}if(i){for(var c=!0,d=!0,T=0;T<s.default.RELATIVE_LEFT_BLOCKING_TILES.length;T++){var p=s.default.RELATIVE_LEFT_BLOCKING_TILES[T];if(l=e.position.x+p[0],h=e.position.y+p[1],r=e.position.z+p[2],t.mappedTiles[n.default.getMappedKeyFromPosition(l,h,r)]){c=!1;break}}for(var u=0;u<s.default.RELATIVE_RIGHT_BLOCKING_TILES.length;u++){var f=s.default.RELATIVE_RIGHT_BLOCKING_TILES[u];if(l=e.position.x+f[0],h=e.position.y+f[1],r=e.position.z+f[2],t.mappedTiles[n.default.getMappedKeyFromPosition(l,h,r)]){d=!1;break}}(c||d)&&t.validTiles.push(n.default.getMappedKeyFromTile(e))}}),this.validPairs=[];for(var e=[].concat(this.validTiles);e.length>0;)for(var i=e.splice(0,1)[0],o=0;o<e.length;o++){var a=e[o];if(this.mappedTiles[a].type===this.mappedTiles[i].type){a=e.splice(o,1)[0],this.validPairs.push([i,a]);break}}cc.log(this.validPairs)},selectTile:function(t){this.selectedTiles&&this.deselectTile(),this.deHighlightHint(),this.selectedTiles=t,this.selectedTiles.highlight()},deselectTile:function(){this.selectedTiles&&this.selectedTiles.dehighlight(),this.selectedTiles=null},highlightHint:function(t,e){this.isHinting&&this.deHighlightHint(),this.isHinting=!0,this.hintPair=[t,e],this.hintPair[0].hintHighlight(),this.hintPair[1].hintHighlight()},deHighlightHint:function(){this.isHinting=!1,this.hintPair&&(this.tiles.includes(this.hintPair[0])&&this.hintPair[0].dehighlight(),this.tiles.includes(this.hintPair[1])&&this.hintPair[1].dehighlight())},onTileClicked:function(t){this.validTiles.includes(n.default.getMappedKeyFromTile(t))&&(this.selectedTiles?t===this.selectedTiles?this.deselectTile():t.type===this.selectedTiles.type?(t.destroy(),this.selectedTiles.destroy(),this.tiles.splice(this.tiles.indexOf(t),1),this.tiles.splice(this.tiles.indexOf(this.selectedTiles),1),this.deselectTile(),this.remapTiles()):this.selectTile(t):this.selectTile(t))},onHintClicked:function(){this.validPairs.length<=0||(isNaN(this.hintPairIter)&&(this.hintPairIter=0),this.hintPairIter=++this.hintPairIter%this.validPairs.length,this.deselectTile(),this.highlightHint(this.mappedTiles[this.validPairs[this.hintPairIter][0]],this.mappedTiles[this.validPairs[this.hintPairIter][1]]))},onShuffleClicked:function(){var t=this;this.deselectTile(),this.deHighlightHint(),this.remainingLayout=[],this.tiles.forEach(function(e){t.remainingLayout.push([e.position.x,e.position.y,e.position.z])}),this.tiles.forEach(function(e){var i=t.remainingLayout.splice(~~(Math.random()*t.remainingLayout.length),1)[0];e.reposition(i[0],i[1],i[2])}),this.remapTiles()}}),cc._RF.pop()},{"./DataManager":"DataManager","./Libs/helpers":"helpers","./Models/Tile":"Tile","./constants":"constants"}],LandingSceneCtor:[function(t,e){"use strict";cc._RF.push(e,"ecadavH4rRILZ0IR5weO34P","LandingSceneCtor"),s(t("./constants"));var i=s(t("./DataManager"));function s(t){return t&&t.__esModule?t:{default:t}}cc.Class({extends:cc.Component,properties:{},onLoad:function(){i.default.loadData()},start:function(){},onPlayClicked:function(){cc.director.loadScene("ingame")}}),cc._RF.pop()},{"./DataManager":"DataManager","./constants":"constants"}],Tile:[function(t,e,i){"use strict";cc._RF.push(e,"efb04ZQ94hEEa50v5D1+G4y","Tile"),i.__esModule=!0,i.default=void 0;var s,n=(s=t("../constants"))&&s.__esModule?s:{default:s},o=t("../DataManager"),a=function(){function t(t,e,i){this.node=new cc.Node("Sprite"),this.view=this.node.addComponent(cc.Sprite),this.node.parent=t,this.node.on("mousedown",this.onclick.bind(this),this),this.type=e,this.position={},this.position.x=i[1],this.position.y=i[2],this.position.z=i[3];var s=o.getTileTypes()[this.type];"Flower"===s?s=s+"_"+o.getFlowerTheme():"Season"===s&&(s=s+"_"+o.getSeasonTheme()),cc.resources.load("Tiles/"+s,cc.SpriteFrame,function(t,e){e.addRef(),this.view.spriteFrame=e,this.updateRealPosition()}.bind(this))}var e=t.prototype;return e.updateRealPosition=function(){this.node.x=this.position.x*(n.default.TILE_WIDTH/2-n.default.TILE_OFFSET_X)+this.position.z*n.default.TILE_STACK_OFFSET_X,this.node.y=this.position.y*(n.default.TILE_HEIGHT/2-n.default.TILE_OFFSET_TOP_Y)-this.position.z*n.default.TILE_STACK_OFFSET_Y,this.node.setContentSize(n.default.TILE_WIDTH,n.default.TILE_HEIGHT),this.node.zIndex=1e3*this.position.z+100*this.position.y+10*this.position.x},e.reposition=function(t,e,i){this.position={},this.position.x=t,this.position.y=e,this.position.z=i,this.updateRealPosition()},e.hintHighlight=function(){this.node.color=new cc.color(n.default.TILE_HINT_COLOR)},e.highlight=function(){this.node.color=new cc.color(n.default.TILE_HIGHTLIGHT_COLOR)},e.dehighlight=function(){this.node.color=new cc.color("#FFFFFF")},e.destroy=function(){this.node.destroy()},e.onclick=function(t){t.stopPropagation(),this.node.emit("clicked",this)},t}();i.default=a,e.exports=i.default,cc._RF.pop()},{"../DataManager":"DataManager","../constants":"constants"}],constants:[function(t,e,i){"use strict";cc._RF.push(e,"ad93eoF2JtAnLaSo8UmrzRb","constants"),i.__esModule=!0,i.default=void 0,i.default={TABLE_SCALE:.42,TABLE_OFFSET_X:-15,TABLE_OFFSET_Y:0,TILE_WIDTH:86,TILE_HEIGHT:124,TILE_STACK_OFFSET_X:3,TILE_STACK_OFFSET_Y:16,TILE_OFFSET_X:2,TILE_OFFSET_TOP_Y:9,TILE_PER_TYPE:4,TILE_SEASON_THEME:["Spring","Summer","Autumn","Winter"],TILE_FLOWER_THEME:["Type1","Type2","Type3","Type4"],TILE_HIGHTLIGHT_COLOR:"#8EB7FF",TILE_HINT_COLOR:"#00FF00",RELATIVE_TOP_BLOCKING_TILES:[[0,0,1],[1,1,1],[1,-1,1],[-1,1,1],[-1,-1,1]],RELATIVE_LEFT_BLOCKING_TILES:[[-2,0,0],[-2,1,0],[-2,-1,0]],RELATIVE_RIGHT_BLOCKING_TILES:[[2,0,0],[2,1,0],[2,-1,0]]},e.exports=i.default,cc._RF.pop()},{}],helpers:[function(t,e){"use strict";cc._RF.push(e,"27317LYnohKlLhuyXz/wavH","helpers"),e.exports.getMappedKeyFromTile=function(t){return this.getMappedKeyFromPosition(t.position.x,t.position.y,t.position.z)},e.exports.getMappedKeyFromPosition=function(t,e,i){return t+"_"+e+"_"+i},cc._RF.pop()},{}]},{},["DataManager","IngameSceneCtor","LandingSceneCtor","helpers","Tile","constants"]);
//# sourceMappingURL=index.js.map
