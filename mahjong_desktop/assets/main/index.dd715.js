window.__require=function e(t,i,n){function o(a,r){if(!i[a]){if(!t[a]){var l=a.split("/");if(l=l[l.length-1],!t[l]){var h="function"==typeof __require&&__require;if(!r&&h)return h(l,!0);if(s)return s(l,!0);throw new Error("Cannot find module '"+a+"'")}a=l}var c=i[a]={exports:{}};t[a][0].call(c.exports,function(e){return o(t[a][1][e]||e)},c,c.exports,e,t,i,n)}return i[a].exports}for(var s="function"==typeof __require&&__require,a=0;a<n.length;a++)o(n[a]);return o}({DataManager:[function(e,t){"use strict";var i;cc._RF.push(t,"6d230WjzGpMpoY8h1MOJbgy","DataManager"),(i=e("./constants"))&&i.__esModule,t.exports.loadData=function(){window.gameData={},cc.resources.load("Data/layout",function(e,t){window.gameData.tableLayout=t.json}),cc.resources.load("Data/tiles",function(e,t){window.gameData.tileTypes=t.json})},t.exports.getLayout=function(){return window.gameData.tableLayout},t.exports.getTileTypes=function(){return window.gameData.tileTypes},cc._RF.pop()},{"./constants":"constants"}],IngamePopupCtor:[function(e,t){"use strict";cc._RF.push(t,"0be6bcpI+hAir+Z+NMC0EJ2","IngamePopupCtor");var i,n=(i=e("./Libs/helpers"))&&i.__esModule?i:{default:i},o=e("./DataManager");cc.Class({extends:cc.Component,properties:{overlay:cc.Node,helpPopup:cc.Node,ingameMenu:cc.Node,debriefPopup:cc.Node,debriefFinalScoreText:cc.Label,debriefProgressText:cc.Label,debriefProgressScoreText:cc.Label,debriefRawScoreText:cc.Label},start:function(){},reset:function(){this.overlay.active=!1,this.helpPopup.active=!1,this.ingameMenu.active=!1,this.debriefPopup.active=!1},showIngameMenu:function(){this.overlay.active=!0,this.ingameController.pauseGame(),this.ingameMenu.active=!0},showHelpPopup:function(){this.overlay.active=!0,this.ingameController.pauseGame(),this.helpPopup.active=!0},showDebriefScreen:function(){this.overlay.active=!0,this.ingameController.pauseGame(),this.debriefPopup.active=!0,this.debriefFinalScoreText.string=n.default.formatDecimalString(this.ingameController.score),this.debriefRawScoreText.string=n.default.formatDecimalString(this.ingameController.score),this.debriefProgressScoreText.string="0",this.debriefProgressText.string=100-Math.floor(this.ingameController.tiles.length/o.getLayout().length*100)+"% Completed"},onResumeClicked:function(){this.overlay.active=!0,this.overlay.active=!1,this.helpPopup.active=!1,this.ingameMenu.active=!1,this.debriefPopup.active=!1,this.ingameController.resumeGame()},onQuitClicked:function(){cc.director.loadScene("landing")},onRestartClicked:function(){cc.director.loadScene("ingame")}}),cc._RF.pop()},{"./DataManager":"DataManager","./Libs/helpers":"helpers"}],IngameSceneCtor:[function(e,t){"use strict";cc._RF.push(t,"09b929JsbZE6LnNEKlAq2xZ","IngameSceneCtor");var i=r(e("./Models/Tile")),n=r(e("./constants")),o=r(e("./Libs/helpers")),s=r(e("./IngameUICtor")),a=r(e("./IngamePopupCtor"));function r(e){return e&&e.__esModule?e:{default:e}}var l=e("./DataManager");cc.Class({extends:cc.Component,properties:{uiController:s.default,popupController:a.default,loadingText:cc.Label,tableNode:cc.Node},onLoad:function(){this.uiController.ingameController=this,this.popupController.ingameController=this,this.uiController.popupController=this.popupController,this.popupController.uiController=this.uiController,this.uiController.reset(),this.popupController.reset()},start:function(){var e=this;this.tableNode.setScale(n.default.TABLE_SCALE),this.tableNode.x=n.default.TABLE_OFFSET_X,this.tableNode.y=n.default.TABLE_OFFSET_Y,this.timer=n.default.GAME_DURATION,this.score=0,this.hintRemaining=n.default.GAME_HINT_TIMES,this.shuffleRemaining=n.default.GAME_SHUFFLE_TIMES,this.isPlaying=!1,this.isGameBegan=!1,cc.resources.preloadDir("Tiles",cc.SpriteFrame,function(){e.generateTiles(),e.isPlaying=!0,e.uiController.hideLoadingText(),e.uiController.updateTimer(),e.uiController.updateHint(),e.uiController.updateShuffle()})},update:function(e){this.isPlaying&&this.isGameBegan&&(this.timer-=1e3*e,this.uiController.updateTimer()),this.timer<=0&&this.endGame()},generateTiles:function(){var e=this;window.gameData.flowerCounter=0,window.gameData.seasonCounter=0;for(var t=[],n=0;n<l.getTileTypes().length;n++)for(var o=0;o<4;o++)t.push(n);t.length===l.getLayout().length?(this.tiles=[],l.getLayout().forEach(function(n){var o=~~(Math.random()*t.length),s=t[o];t.splice(o,1);var a=new i.default(e.tableNode,s,n);a.node.on("clicked",e.onTileClicked,e),e.tiles.push(a)}),this.remapTiles(),0===this.validPairs.length&&this.shuffleTiles(!0)):cc.error("Invalid data")},remapTiles:function(){var e=this;this.mappedTiles={},this.tiles.forEach(function(t){e.mappedTiles[o.default.getMappedKeyFromTile(t)]=t}),this.validTiles=[],this.tiles.forEach(function(t){for(var i=!0,s=0;s<n.default.RELATIVE_TOP_BLOCKING_TILES.length;s++){var a=n.default.RELATIVE_TOP_BLOCKING_TILES[s],r=t.position.x+a[0],l=t.position.y+a[1],h=t.position.z+a[2];if(e.mappedTiles[o.default.getMappedKeyFromPosition(r,l,h)]){i=!1;break}}if(i){for(var c=!0,u=!0,d=0;d<n.default.RELATIVE_LEFT_BLOCKING_TILES.length;d++){var f=n.default.RELATIVE_LEFT_BLOCKING_TILES[d];if(r=t.position.x+f[0],l=t.position.y+f[1],h=t.position.z+f[2],e.mappedTiles[o.default.getMappedKeyFromPosition(r,l,h)]){c=!1;break}}for(var p=0;p<n.default.RELATIVE_RIGHT_BLOCKING_TILES.length;p++){var g=n.default.RELATIVE_RIGHT_BLOCKING_TILES[p];if(r=t.position.x+g[0],l=t.position.y+g[1],h=t.position.z+g[2],e.mappedTiles[o.default.getMappedKeyFromPosition(r,l,h)]){u=!1;break}}(c||u)&&e.validTiles.push(o.default.getMappedKeyFromTile(t))}}),this.validPairs=[];for(var t=[].concat(this.validTiles);t.length>0;)for(var i=t.splice(0,1)[0],s=0;s<t.length;s++){var a=t[s];if(this.mappedTiles[a].type===this.mappedTiles[i].type){a=t.splice(s,1)[0],this.validPairs.push([i,a]);break}}this.uiController.updateIngameData()},selectTile:function(e){this.selectedTiles&&this.deselectTile(),this.deHighlightHint(),this.selectedTiles=e,this.selectedTiles.highlight()},scoreTilePair:function(e,t){if(e.type===t.type){var i=e.type;this.addScore(i),e.destroy(),t.destroy(),this.tiles.splice(this.tiles.indexOf(e),1),this.tiles.splice(this.tiles.indexOf(t),1),this.deselectTile(),this.isGameBegan||(this.isGameBegan=!0,this.timer-=1e3),0===this.tiles.length?this.endGame():(this.remapTiles(),this.checkNoMoreMove())}},addScore:function(e){var t=l.getTileTypes()[e][1],i=Math.ceil(.5*t*this.tiles.length);this.score+=i,this.uiController.updateScore()},deselectTile:function(){this.selectedTiles&&this.selectedTiles.dehighlight(),this.selectedTiles=null},highlightHint:function(e,t){this.isHinting&&this.deHighlightHint(),this.isHinting=!0,this.hintPair=[e,t],this.hintPair[0].hintHighlight(),this.hintPair[1].hintHighlight()},deHighlightHint:function(){this.isHinting=!1,this.hintPair&&(this.tiles.includes(this.hintPair[0])&&this.hintPair[0].dehighlight(),this.tiles.includes(this.hintPair[1])&&this.hintPair[1].dehighlight())},shuffleTiles:function(e){var t=this;if(void 0===e&&(e=!1),!e){if(!this.isPlaying)return;if(this.shuffleRemaining<=0)return;this.shuffleRemaining--,this.uiController.updateShuffle()}this.deselectTile(),this.deHighlightHint();var i=0;do{this.remainingLayout=[],this.tiles.forEach(function(e){t.remainingLayout.push([e.position.x,e.position.y,e.position.z])}),this.tiles.forEach(function(e){var i=t.remainingLayout.splice(~~(Math.random()*t.remainingLayout.length),1)[0];e.reposition(i[0],i[1],i[2])}),this.remapTiles(),i++}while(0===this.validPairs.length&&i<10);this.checkNoMoreMove()},checkNoMoreMove:function(){var e=this;0===this.validPairs.length&&(this.shuffleRemaining>0?(this.isPlaying=!1,this.uiController.showShuffleNotification("reshuffle"),this.scheduleOnce(function(){e.isPlaying=!0,e.uiController.hideShuffleNotification(),e.shuffleTiles()},1)):(this.isPlaying=!1,this.uiController.showShuffleNotification("end"),this.scheduleOnce(function(){e.isPlaying=!0,e.uiController.hideShuffleNotification(),e.endGame()},1)))},showHintPair:function(){this.isPlaying&&(this.validPairs.length<=0||this.hintRemaining<=0||(this.hintRemaining--,this.uiController.updateHint(),isNaN(this.hintPairIter)&&(this.hintPairIter=0),this.hintPairIter=++this.hintPairIter%this.validPairs.length,this.deselectTile(),this.highlightHint(this.mappedTiles[this.validPairs[this.hintPairIter][0]],this.mappedTiles[this.validPairs[this.hintPairIter][1]])))},endGame:function(){this.isPlaying=!1,this.popupController.showDebriefScreen()},pauseGame:function(){this.isPlaying=!1},resumeGame:function(){this.isPlaying=!0},onTileClicked:function(e){this.isPlaying&&this.validTiles.includes(o.default.getMappedKeyFromTile(e))&&(this.selectedTiles?e===this.selectedTiles?this.deselectTile():e.type===this.selectedTiles.type?this.scoreTilePair(e,this.selectedTiles):this.selectTile(e):this.selectTile(e))}}),cc._RF.pop()},{"./DataManager":"DataManager","./IngamePopupCtor":"IngamePopupCtor","./IngameUICtor":"IngameUICtor","./Libs/helpers":"helpers","./Models/Tile":"Tile","./constants":"constants"}],IngameUICtor:[function(e,t){"use strict";cc._RF.push(t,"653c2FywYdLE5u3WI75R5Eh","IngameUICtor"),n(e("./IngameSceneCtor")),n(e("./IngamePopupCtor"));var i=n(e("./Libs/helpers"));function n(e){return e&&e.__esModule?e:{default:e}}cc.Class({extends:cc.Component,properties:{pairText:cc.Label,timeText:cc.Label,scoreText:cc.Label,tilesText:cc.Label,shuffleRemainingText:cc.Label,hintRemainingText:cc.Label,loadingText:cc.Label,shuffleNotificationText:cc.Label,shuffleButton:cc.Button,hintButton:cc.Button},start:function(){},reset:function(){this.loadingText.node.active=!0,this.shuffleNotificationText.node.active=!1,this.pairText.string="0",this.timeText.string="00:00",this.scoreText.string="0",this.tilesText.string="0",this.shuffleRemainingText.node.opacity=255,this.shuffleRemainingText.string="0x",this.hintRemainingText.node.opacity=255,this.hintRemainingText.string="0x",this.shuffleButton.interactable=!0,this.hintButton.interactable=!0},hideLoadingText:function(){this.loadingText.node.active=!1},disableShuffle:function(){this.shuffleRemainingText.node.opacity=128,this.shuffleButton.interactable=!1},disableHint:function(){this.hintRemainingText.node.opacity=128,this.hintButton.interactable=!1},updateIngameData:function(){this.pairText.string=this.ingameController.validPairs.length,this.tilesText.string=this.ingameController.tiles.length},updateShuffle:function(){this.shuffleRemainingText.string=this.ingameController.shuffleRemaining+"x",0===this.ingameController.shuffleRemaining&&this.disableShuffle()},updateHint:function(){this.hintRemainingText.string=this.ingameController.hintRemaining+"x",0===this.ingameController.hintRemaining&&this.disableHint()},updateTimer:function(){this.timeText.string=i.default.formatTimer(this.ingameController.timer)},updateScore:function(){this.scoreText.string=i.default.formatDecimalString(this.ingameController.score)},showShuffleNotification:function(e){"reshuffle"===e?this.shuffleNotificationText.string="No more move,\nReshuffling...":"end"===e&&(this.shuffleNotificationText.string="No more move,\nGame over!"),this.shuffleNotificationText.node.active=!0},hideShuffleNotification:function(){this.shuffleNotificationText.node.active=!1},onHintClicked:function(){this.ingameController.showHintPair()},onShuffleClicked:function(){this.ingameController.shuffleTiles()},onPauseClicked:function(){this.popupController.showIngameMenu()},onHelpClicked:function(){this.popupController.showHelpPopup()}}),cc._RF.pop()},{"./IngamePopupCtor":"IngamePopupCtor","./IngameSceneCtor":"IngameSceneCtor","./Libs/helpers":"helpers"}],LandingSceneCtor:[function(e,t){"use strict";cc._RF.push(t,"ecadavH4rRILZ0IR5weO34P","LandingSceneCtor"),n(e("./constants"));var i=n(e("./DataManager"));function n(e){return e&&e.__esModule?e:{default:e}}cc.Class({extends:cc.Component,properties:{},onLoad:function(){i.default.loadData()},start:function(){},onPlayClicked:function(){cc.director.loadScene("ingame")}}),cc._RF.pop()},{"./DataManager":"DataManager","./constants":"constants"}],Tile:[function(e,t,i){"use strict";cc._RF.push(t,"efb04ZQ94hEEa50v5D1+G4y","Tile"),i.__esModule=!0,i.default=void 0;var n,o=(n=e("../constants"))&&n.__esModule?n:{default:n},s=e("../DataManager"),a=function(){function e(e,t,i){this.node=new cc.Node("Sprite"),this.view=this.node.addComponent(cc.Sprite),this.node.parent=e,this.node.on("mousedown",this.onclick.bind(this),this),this.type=t,this.position={},this.position.x=i[1],this.position.y=i[2],this.position.z=i[3];var n=s.getTileTypes()[this.type][0];"Flower"===n?(n=n+"_"+o.default.TILE_FLOWER_THEME[window.gameData.flowerCounter],window.gameData.flowerCounter++):"Season"===n&&(n=n+"_"+o.default.TILE_SEASON_THEME[window.gameData.seasonCounter],window.gameData.seasonCounter++),cc.resources.load("Tiles/"+n,cc.SpriteFrame,function(e,t){t.addRef(),this.view.spriteFrame=t,this.updateWorldPosition()}.bind(this))}var t=e.prototype;return t.updateWorldPosition=function(){this.node.x=this.position.x*(o.default.TILE_WIDTH/2-o.default.TILE_OFFSET_X)+this.position.z*o.default.TILE_STACK_OFFSET_X,this.node.y=this.position.y*(o.default.TILE_HEIGHT/2-o.default.TILE_OFFSET_TOP_Y)-this.position.z*o.default.TILE_STACK_OFFSET_Y,this.node.setContentSize(o.default.TILE_WIDTH,o.default.TILE_HEIGHT),this.node.zIndex=1e3*this.position.z+100*this.position.y+10*this.position.x},t.reposition=function(e,t,i){this.position={},this.position.x=e,this.position.y=t,this.position.z=i,this.updateWorldPosition()},t.hintHighlight=function(){this.node.color=new cc.color(o.default.TILE_HINT_COLOR)},t.highlight=function(){this.node.color=new cc.color(o.default.TILE_HIGHTLIGHT_COLOR)},t.dehighlight=function(){this.node.color=new cc.color("#FFFFFF")},t.destroy=function(){this.node.destroy()},t.onclick=function(e){e.stopPropagation(),this.node.emit("clicked",this)},e}();i.default=a,t.exports=i.default,cc._RF.pop()},{"../DataManager":"DataManager","../constants":"constants"}],constants:[function(e,t,i){"use strict";cc._RF.push(t,"ad93eoF2JtAnLaSo8UmrzRb","constants"),i.__esModule=!0,i.default=void 0,i.default={GAME_DURATION:6e5,GAME_HINT_TIMES:3,GAME_SHUFFLE_TIMES:3,TABLE_SCALE:.42,TABLE_OFFSET_X:-15,TABLE_OFFSET_Y:0,TILE_WIDTH:86,TILE_HEIGHT:124,TILE_STACK_OFFSET_X:3,TILE_STACK_OFFSET_Y:16,TILE_OFFSET_X:2,TILE_OFFSET_TOP_Y:9,TILE_PER_TYPE:4,TILE_SEASON_THEME:["Spring","Summer","Autumn","Winter"],TILE_FLOWER_THEME:["Type1","Type2","Type3","Type4"],TILE_HIGHTLIGHT_COLOR:"#8EB7FF",TILE_HINT_COLOR:"#00FF00",RELATIVE_TOP_BLOCKING_TILES:[[0,0,1],[1,1,1],[1,-1,1],[-1,1,1],[-1,-1,1]],RELATIVE_LEFT_BLOCKING_TILES:[[-2,0,0],[-2,1,0],[-2,-1,0]],RELATIVE_RIGHT_BLOCKING_TILES:[[2,0,0],[2,1,0],[2,-1,0]]},t.exports=i.default,cc._RF.pop()},{}],helpers:[function(e,t){"use strict";cc._RF.push(t,"27317LYnohKlLhuyXz/wavH","helpers"),t.exports.getMappedKeyFromTile=function(e){return this.getMappedKeyFromPosition(e.position.x,e.position.y,e.position.z)},t.exports.getMappedKeyFromPosition=function(e,t,i){return e+"_"+t+"_"+i},t.exports.formatDurationDHMSObject=function(e){e=Math.max(0,e);var t=Math.ceil(e/1e3),i=Math.floor(t/60),n=Math.floor(i/60),o=Math.floor(n/24);return{seconds:t%=60,minutes:i%=60,hours:n%=24,days:o}},t.exports.formatTimer=function(e){var t=this.formatDurationDHMSObject(e),i=t.seconds,n=t.minutes,o=t.hours,s=t.days,a=n>9||0===o?n:"0"+n,r=i>9?i:"0"+i;return s>=1?s+":"+o+":"+n+":"+i:o>=1?o+":"+a+":"+r:a+":"+r},t.exports.formatDecimalString=function(e){return e.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")},cc._RF.pop()},{}]},{},["DataManager","IngamePopupCtor","IngameSceneCtor","IngameUICtor","LandingSceneCtor","helpers","Tile","constants"]);
//# sourceMappingURL=index.js.map
