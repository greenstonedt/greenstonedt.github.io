window.__require=function e(t,i,o){function c(r,n){if(!i[r]){if(!t[r]){var a=r.split("/");if(a=a[a.length-1],!t[a]){var p="function"==typeof __require&&__require;if(!n&&p)return p(a,!0);if(s)return s(a,!0);throw new Error("Cannot find module '"+r+"'")}r=a}var l=i[r]={exports:{}};t[r][0].call(l.exports,function(e){return c(t[r][1][e]||e)},l,l.exports,e,t,i,o)}return i[r].exports}for(var s="function"==typeof __require&&__require,r=0;r<o.length;r++)c(o[r]);return c}({ball:[function(e,t){"use strict";cc._RF.push(t,"1f855lMJnZLjJf2bPQGKBbg","ball");var i=c(e("./pickup")),o=c(e("./ingameCtor"));function c(e){return e&&e.__esModule?e:{default:e}}cc.Class({extends:cc.Component,properties:{controller:o.default},onLoad:function(){},start:function(){},setType:function(){},update:function(){},onBeginContact:function(e,t,o){var c=o.getComponent(i.default);c&&this.controller.eatPickup(c.node)}}),cc._RF.pop()},{"./ingameCtor":"ingameCtor","./pickup":"pickup"}],block:[function(e,t){"use strict";cc._RF.push(t,"dfa28y7x0BNFZQ9xARhs4Og","block"),cc.Class({extends:cc.Component,properties:{leftSprite:cc.SpriteFrame,rightSprite:cc.SpriteFrame,middleSprite:cc.SpriteFrame,singleSprite:cc.SpriteFrame},onLoad:function(){this.sprite=this.getComponent(cc.Sprite)},start:function(){},setType:function(e){switch(e){case"left":this.sprite.spriteFrame=this.leftSprite;break;case"right":this.sprite.spriteFrame=this.rightSprite;break;case"middle":this.sprite.spriteFrame=this.middleSprite;break;default:this.sprite.spriteFrame=this.singleSprite}},update:function(){}}),cc._RF.pop()},{}],ingameCtor:[function(e,t){"use strict";cc._RF.push(t,"f248dKnGNxJz51/88AFA/6x","ingameCtor");var i=s(e("./libs/perlin")),o=s(e("./block")),c=(s(e("./pickup")),s(e("./ingameUICtor")));function s(e){return e&&e.__esModule?e:{default:e}}cc.Class({extends:cc.Component,properties:{uiController:c.default,ball:cc.Node,blockPrefab:cc.Prefab,pickup:cc.Prefab,gameCamera:cc.Node},onLoad:function(){this.uiController.ingameController=this,cc.director.getPhysicsManager().enabled=!0,cc.director.getPhysicsManager().gravity=cc.v2(0,-800);var e=cc.director.getPhysicsManager();e.enabledAccumulator=!0,e.FIXED_TIME_STEP=1/30,e.VELOCITY_ITERATIONS=8,e.POSITION_ITERATIONS=8,cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this),this.isLeftPressed=!1,this.isRightPressed=!1,this.blocksPerRow=this.node.width/40-2,this.playingTime=0,this.score=0,cc.director.isPaused&&cc.director.resume()},start:function(){var e=this;this.blockPool=new cc.NodePool("block"),this.pickupPool=new cc.NodePool("pickup"),this.blocks=[],this.pickups=[],i.default.seed(Math.random());for(var t=0;t<5;++t){var c=cc.instantiate(this.blockPrefab);this.blockPool.put(c),(c=this.blockPool.get()).parent=this.node,c.position=cc.Vec3(40*t-80,100),c.getComponent(cc.PhysicsBoxCollider).restitution=.4,c.getComponent(cc.PhysicsBoxCollider).apply(),c.getComponent(o.default).setType(0===t?"left":4===t?"right":"middle"),this.blocks.push(c)}this.spawningBlockY=-100,this.spawningBlockTime=0,this.checkAndCreateBlock(),this.uiController.updateScoreLabel(this.score),cc.director.pause(),this.uiController.popupOverlay.active=!0,setTimeout(function(){e.uiController.showReadyLabel()},300),setTimeout(function(){e.uiController.hideReadyLabel(),e.uiController.popupOverlay.active=!1},1800),setTimeout(function(){cc.director.resume()},2e3)},checkAndCreateBlock:function(){for(;this.spawningBlockY>this.gameCamera.y-320;){for(var e=(this.blocksPerRow-1)/2,t=[],c=!1,s=0;s<this.blocksPerRow;s++)if(i.default.simplex2(s,this.spawningBlockTime)>0){if(this.blockPool.size()<=0){var r=cc.instantiate(this.blockPrefab);this.blockPool.put(r)}var n=this.blockPool.get();if(n.parent=this.node,n.position=cc.Vec3(40*(-e+s),this.spawningBlockY),n.getComponent(cc.PhysicsBoxCollider).restitution=.4*Math.max(1-.05*.1*this.playingTime,0),n.getComponent(cc.PhysicsBoxCollider).apply(),this.blocks.push(n),t.push(n),!c&&Math.random()<=.1){if(this.pickupPool.size()<=0){var a=cc.instantiate(this.pickup);this.pickupPool.put(a)}var p=this.pickupPool.get();p.parent=this.node,p.position=cc.Vec3(40*(-e+s),this.spawningBlockY+36),this.pickups.push(p),c=!0}}else t.push(null);for(s=0;s<this.blocksPerRow;s++)if(t[s]){var l=!1,u=!1;s-1>=0&&t[s-1]&&(l=!0),s+1<this.blocksPerRow&&t[s+1]&&(u=!0);var h=t[s];l&&u?h.getComponent(o.default).setType("middle"):l?h.getComponent(o.default).setType("right"):u?h.getComponent(o.default).setType("left"):h.getComponent(o.default).setType("single")}this.spawningBlockY-=200,this.spawningBlockTime++}},update:function(e){var t=this.ball.getComponent(cc.RigidBody);this.isLeftPressed&&(t.linearVelocity=cc.v2(Math.min(t.linearVelocity.x,0),t.linearVelocity.y),t.applyLinearImpulse(cc.v2(-3e3*e,0),t.getWorldCenter())),this.isRightPressed&&(t.linearVelocity=cc.v2(Math.max(t.linearVelocity.x,0),t.linearVelocity.y),t.applyLinearImpulse(cc.v2(3e3*e,0),t.getWorldCenter())),this.playingTime+=e;var i=50*e*(1+.05*this.playingTime);this.gameCamera.y-=i;for(var o=this.blocks.length-1;o>=0;o--){var c=this.blocks[o];c.position.y>this.gameCamera.y+320&&(this.blockPool.put(c),this.blocks.splice(o,1))}for(var s=this.pickups.length-1;s>=0;s--){var r=this.pickups[s];r.position.y>this.gameCamera.y+320&&(this.pickupPool.put(r),this.pickups.splice(s,1))}this.checkAndCreateBlock(),this.score+=10*e,this.uiController.updateScoreLabel(this.score)},lateUpdate:function(){Math.abs(this.ball.y-this.gameCamera.y)>320&&this.endGame();var e=this.ball.getComponent(cc.RigidBody);e.linearVelocity=cc.v2(e.linearVelocity.x/Math.abs(e.linearVelocity.x)*Math.min(Math.abs(e.linearVelocity.x),200),e.linearVelocity.y),this.isRightPressed||this.isLeftPressed||(e.linearVelocity=cc.v2(.8*e.linearVelocity.x,e.linearVelocity.y))},eatPickup:function(e){this.pickupPool.put(e),this.pickups.splice(this.pickups.indexOf(e),1),this.score+=200,this.uiController.updateScoreLabel(this.score)},pauseGame:function(){cc.director.pause(),this.uiController.showPopup("pause")},endGame:function(){cc.director.pause(),this.uiController.showPopup("result")},resumeGame:function(){cc.director.resume(),this.uiController.hidePopup()},quitGame:function(){cc.director.loadScene("landing")},restartGame:function(){cc.director.loadScene("ingame")},onKeyDown:function(e){switch(e.keyCode){case cc.macro.KEY.left:case cc.macro.KEY.dpadLeft:this.isLeftPressed=!0;break;case cc.macro.KEY.right:case cc.macro.KEY.dpadRight:this.isRightPressed=!0}},onKeyUp:function(e){switch(e.keyCode){case cc.macro.KEY.left:case cc.macro.KEY.dpadLeft:this.isLeftPressed=!1;break;case cc.macro.KEY.right:case cc.macro.KEY.dpadRight:this.isRightPressed=!1}}}),cc._RF.pop()},{"./block":"block","./ingameUICtor":"ingameUICtor","./libs/perlin":"perlin","./pickup":"pickup"}],ingameUICtor:[function(e,t){"use strict";cc._RF.push(t,"7bb42GScFVC54uXdQ4eXL54","ingameUICtor"),cc.Class({extends:cc.Component,properties:{popupOverlay:cc.Node,resultPopup:cc.Node,pausePopup:cc.Node,readyLabel:cc.Node,scoreLabel:cc.Label},onLoad:function(){this.hideReadyLabel(),this.hidePopup()},start:function(){},hidePopup:function(){this.popupOverlay.active=!1,this.resultPopup.active=!1,this.pausePopup.active=!1},showPopup:function(e){switch(this.hidePopup(),this.popupOverlay.active=!0,e){case"pause":this.pausePopup.active=!0;break;case"result":this.resultPopup.active=!0}},hideReadyLabel:function(){this.readyLabel.active=!1},showReadyLabel:function(){this.readyLabel.active=!0},updateScoreLabel:function(e){this.scoreLabel.string=Math.round(e)},onResumeClicked:function(){this.ingameController.resumeGame(),this.hidePopup()},onPauseClicked:function(){this.ingameController.pauseGame()},onRestartClicked:function(){this.ingameController.restartGame()},onQuitClicked:function(){this.ingameController.quitGame()}}),cc._RF.pop()},{}],landingCtor:[function(e,t){"use strict";cc._RF.push(t,"ce4baYvJeFD6Jgwr6IrucOp","landingCtor"),cc.Class({extends:cc.Component,properties:{},start:function(){},onPlayClicked:function(){cc.director.loadScene("ingame")}}),cc._RF.pop()},{}],perlin:[function(e,t){"use strict";function i(e,t,i){this.x=e,this.y=t,this.z=i}cc._RF.push(t,"bd596Ss6v1BuIwW9SnsQQSk","perlin"),i.prototype.dot2=function(e,t){return this.x*e+this.y*t},i.prototype.dot3=function(e,t,i){return this.x*e+this.y*t+this.z*i};var o=[new i(1,1,0),new i(-1,1,0),new i(1,-1,0),new i(-1,-1,0),new i(1,0,1),new i(-1,0,1),new i(1,0,-1),new i(-1,0,-1),new i(0,1,1),new i(0,-1,1),new i(0,1,-1),new i(0,-1,-1)],c=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],s=new Array(512),r=new Array(512);t.exports.seed=function(e){e>0&&e<1&&(e*=65536),(e=Math.floor(e))<256&&(e|=e<<8);for(var t=0;t<256;t++){var i;i=1&t?c[t]^255&e:c[t]^e>>8&255,s[t]=s[t+256]=i,r[t]=r[t+256]=o[i%12]}},t.exports.seed(0);var n=.5*(Math.sqrt(3)-1),a=(3-Math.sqrt(3))/6;function p(e){return e*e*e*(e*(6*e-15)+10)}function l(e,t,i){return(1-i)*e+i*t}t.exports.simplex2=function(e,t){var i,o,c=(e+t)*n,p=Math.floor(e+c),l=Math.floor(t+c),u=(p+l)*a,h=e-p+u,d=t-l+u;h>d?(i=1,o=0):(i=0,o=1);var f=h-i+a,m=d-o+a,g=h-1+2*a,y=d-1+2*a,C=r[(p&=255)+s[l&=255]],k=r[p+i+s[l+o]],b=r[p+1+s[l+1]],v=.5-h*h-d*d,P=.5-f*f-m*m,w=.5-g*g-y*y;return 70*((v<0?0:(v*=v)*v*C.dot2(h,d))+(P<0?0:(P*=P)*P*k.dot2(f,m))+(w<0?0:(w*=w)*w*b.dot2(g,y)))},t.exports.simplex3=function(e,t,i){var o,c,n,a,p,l,u=(e+t+i)*(1/3),h=Math.floor(e+u),d=Math.floor(t+u),f=Math.floor(i+u),m=(h+d+f)*(1/6),g=e-h+m,y=t-d+m,C=i-f+m;g>=y?y>=C?(o=1,c=0,n=0,a=1,p=1,l=0):g>=C?(o=1,c=0,n=0,a=1,p=0,l=1):(o=0,c=0,n=1,a=1,p=0,l=1):y<C?(o=0,c=0,n=1,a=0,p=1,l=1):g<C?(o=0,c=1,n=0,a=0,p=1,l=1):(o=0,c=1,n=0,a=1,p=1,l=0);var k=g-o+1/6,b=y-c+1/6,v=C-n+1/6,P=g-a+1/6*2,w=y-p+1/6*2,x=C-l+1/6*2,R=g-1+.5,_=y-1+.5,L=C-1+.5,S=r[(h&=255)+s[(d&=255)+s[f&=255]]],M=r[h+o+s[d+c+s[f+n]]],T=r[h+a+s[d+p+s[f+l]]],F=r[h+1+s[d+1+s[f+1]]],E=.6-g*g-y*y-C*C,B=.6-k*k-b*b-v*v,I=.6-P*P-w*w-x*x,V=.6-R*R-_*_-L*L;return 32*((E<0?0:(E*=E)*E*S.dot3(g,y,C))+(B<0?0:(B*=B)*B*M.dot3(k,b,v))+(I<0?0:(I*=I)*I*T.dot3(P,w,x))+(V<0?0:(V*=V)*V*F.dot3(R,_,L)))},t.exports.perlin2=function(e,t){var i=Math.floor(e),o=Math.floor(t);e-=i,t-=o;var c=r[(i&=255)+s[o&=255]].dot2(e,t),n=r[i+s[o+1]].dot2(e,t-1),a=r[i+1+s[o]].dot2(e-1,t),u=r[i+1+s[o+1]].dot2(e-1,t-1),h=p(e);return l(l(c,a,h),l(n,u,h),p(t))},t.exports.perlin3=function(e,t,i){var o=Math.floor(e),c=Math.floor(t),n=Math.floor(i);e-=o,t-=c,i-=n;var a=r[(o&=255)+s[(c&=255)+s[n&=255]]].dot3(e,t,i),u=r[o+s[c+s[n+1]]].dot3(e,t,i-1),h=r[o+s[c+1+s[n]]].dot3(e,t-1,i),d=r[o+s[c+1+s[n+1]]].dot3(e,t-1,i-1),f=r[o+1+s[c+s[n]]].dot3(e-1,t,i),m=r[o+1+s[c+s[n+1]]].dot3(e-1,t,i-1),g=r[o+1+s[c+1+s[n]]].dot3(e-1,t-1,i),y=r[o+1+s[c+1+s[n+1]]].dot3(e-1,t-1,i-1),C=p(e),k=p(t),b=p(i);return l(l(l(a,f,C),l(u,m,C),b),l(l(h,g,C),l(d,y,C),b),k)},cc._RF.pop()},{}],pickup:[function(e,t){"use strict";cc._RF.push(t,"b13ff37Sp5LU6CvtWX6uTD8","pickup"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){},start:function(){},setType:function(){},update:function(){}}),cc._RF.pop()},{}]},{},["ball","block","ingameCtor","ingameUICtor","landingCtor","perlin","pickup"]);