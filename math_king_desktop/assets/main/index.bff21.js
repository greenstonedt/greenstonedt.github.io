window.__require=function e(t,i,s){function o(a,l){if(!i[a]){if(!t[a]){var r=a.split("/");if(r=r[r.length-1],!t[r]){var c="function"==typeof __require&&__require;if(!l&&c)return c(r,!0);if(n)return n(r,!0);throw new Error("Cannot find module '"+a+"'")}a=r}var d=i[a]={exports:{}};t[a][0].call(d.exports,function(e){return o(t[a][1][e]||e)},d,d.exports,e,t,i,s)}return i[a].exports}for(var n="function"==typeof __require&&__require,a=0;a<s.length;a++)o(s[a]);return o}({DataManager:[function(e,t){"use strict";cc._RF.push(t,"6d230WjzGpMpoY8h1MOJbgy","DataManager");var i,s=(i=e("./constants"))&&i.__esModule?i:{default:i};window.gameData={},cc.resources.load("Data/layout",function(e,t){window.gameData.tableLayout=t.json}),cc.resources.load("Data/tiles",function(e,t){window.gameData.tileTypes=t.json}),window.gameData.flowerTheme=~~(Math.random()*s.default.TILE_FLOWER_THEME.length),window.gameData.seasonTheme=~~(Math.random()*s.default.TILE_SEASON_THEME.length),t.exports.getLayout=function(){return window.gameData.tableLayout},t.exports.getTileTypes=function(){return window.gameData.tileTypes},t.exports.getFlowerTheme=function(){return s.default.TILE_FLOWER_THEME[window.gameData.flowerTheme]},t.exports.getSeasonTheme=function(){return s.default.TILE_SEASON_THEME[window.gameData.seasonTheme]},cc._RF.pop()},{"./constants":"constants"}],IngameSceneCtor:[function(e,t){"use strict";cc._RF.push(t,"09b929JsbZE6LnNEKlAq2xZ","IngameSceneCtor");var i=n(e("./Models/Tile")),s=n(e("./constants")),o=n(e("./Libs/helpers"));function n(e){return e&&e.__esModule?e:{default:e}}var a=e("./DataManager");cc.Class({extends:cc.Component,properties:{},start:function(){this.table=new cc.Node("Table"),this.table.parent=this.node,this.table.setScale(s.default.TABLE_SCALE),this.table.x=s.default.TABLE_OFFSET_X,this.table.y=s.default.TABLE_OFFSET_Y,this.generateTiles(),cc.log(cc.resources.load)},generateTiles:function(){for(var e=this,t=[],s=0;s<a.getTileTypes().length;s++)for(var o=0;o<4;o++)t.push(s);t.length===a.getLayout().length?(this.tiles=[],a.getLayout().forEach(function(s){var o=~~(Math.random()*t.length),n=t[o];t.splice(o,1);var a=new i.default(e.table,n,s);a.node.on("clicked",e.onTileClicked,e),e.tiles.push(a)}),this.remapTiles()):cc.error("Invalid data")},remapTiles:function(){var e=this;this.mappedTiles={},this.tiles.forEach(function(t){e.mappedTiles[o.default.getMappedKeyFromTile(t)]=t}),this.validTiles=[],this.tiles.forEach(function(t){for(var i=!0,n=0;n<s.default.RELATIVE_TOP_BLOCKING_TILES.length;n++){var a=s.default.RELATIVE_TOP_BLOCKING_TILES[n],l=t.position.x+a[0],r=t.position.y+a[1],c=t.position.z+a[2];if(e.mappedTiles[o.default.getMappedKeyFromPosition(l,r,c)]){i=!1;break}}if(i){for(var d=!0,T=!0,p=0;p<s.default.RELATIVE_LEFT_BLOCKING_TILES.length;p++){var h=s.default.RELATIVE_LEFT_BLOCKING_TILES[p];if(l=t.position.x+h[0],r=t.position.y+h[1],c=t.position.z+h[2],e.mappedTiles[o.default.getMappedKeyFromPosition(l,r,c)]){d=!1;break}}for(var u=0;u<s.default.RELATIVE_RIGHT_BLOCKING_TILES.length;u++){var _=s.default.RELATIVE_RIGHT_BLOCKING_TILES[u];if(l=t.position.x+_[0],r=t.position.y+_[1],c=t.position.z+_[2],e.mappedTiles[o.default.getMappedKeyFromPosition(l,r,c)]){T=!1;break}}(d||T)&&e.validTiles.push(o.default.getMappedKeyFromTile(t))}}),this.validPairs={};for(var t=[].concat(this.validTiles);t.length>0;)for(var i=t.splice(0,1)[0],n=0;n<t.length;n++){var a=t[n];if(a.type===i.type){a=t.splice(n,1)[0],this.validPairs[i]=a;break}}},onTileClicked:function(e){this.validTiles.includes(o.default.getMappedKeyFromTile(e))&&(this.selectedTiles?e===this.selectedTiles?(this.selectedTiles.dehighlight(),this.selectedTiles=null):e.type===this.selectedTiles.type?(e.destroy(),this.selectedTiles.destroy(),this.tiles.splice(this.tiles.indexOf(e),1),this.tiles.splice(this.tiles.indexOf(this.selectedTiles),1),this.selectedTiles=null,this.remapTiles()):(this.selectedTiles.dehighlight(),this.selectedTiles=e,this.selectedTiles.highlight()):(this.selectedTiles=e,this.selectedTiles.highlight()))}}),cc._RF.pop()},{"./DataManager":"DataManager","./Libs/helpers":"helpers","./Models/Tile":"Tile","./constants":"constants"}],LandingSceneCtor:[function(e,t){"use strict";cc._RF.push(t,"ecadavH4rRILZ0IR5weO34P","LandingSceneCtor"),cc.Class({extends:cc.Component,properties:{},start:function(){},onPlayClicked:function(){cc.director.loadScene("ingame")}}),cc._RF.pop()},{}],Tile:[function(e,t,i){"use strict";cc._RF.push(t,"efb04ZQ94hEEa50v5D1+G4y","Tile"),i.__esModule=!0,i.default=void 0;var s,o=(s=e("../constants"))&&s.__esModule?s:{default:s},n=e("../DataManager"),a=function(){function e(e,t,i){this.node=new cc.Node("Sprite"),this.view=this.node.addComponent(cc.Sprite),this.node.parent=e,this.node.on("mousedown",this.onclick.bind(this),this),this.type=t,this.position={},this.position.x=i[1],this.position.y=i[2],this.position.z=i[3],tileName=n.getTileTypes()[this.type],"Flower"===tileName?tileName=tileName+"_"+n.getFlowerTheme():"Season"===tileName&&(tileName=tileName+"_"+n.getSeasonTheme()),cc.resources.load("Tiles/"+tileName,cc.SpriteFrame,function(e,t){t.addRef(),this.view.spriteFrame=t,this.updateRealPosition()}.bind(this))}var t=e.prototype;return t.updateRealPosition=function(){this.node.x=this.position.x*(o.default.TILE_WIDTH/2-o.default.TILE_OFFSET_X)+this.position.z*o.default.TILE_STACK_OFFSET_X,this.node.y=this.position.y*(o.default.TILE_HEIGHT/2-o.default.TILE_OFFSET_TOP_Y)-this.position.z*o.default.TILE_STACK_OFFSET_Y,this.node.setContentSize(o.default.TILE_WIDTH,o.default.TILE_HEIGHT),this.node.zIndex=1e3*this.position.z+100*this.position.y+10*this.position.x},t.highlight=function(){this.node.color=new cc.color(o.default.TILE_HIGHTLIGHT_COLOR)},t.dehighlight=function(){this.node.color=new cc.color("#FFFFFF")},t.destroy=function(){this.node.destroy()},t.onclick=function(e){e.stopPropagation(),this.node.emit("clicked",this)},e}();i.default=a,t.exports=i.default,cc._RF.pop()},{"../DataManager":"DataManager","../constants":"constants"}],constants:[function(e,t,i){"use strict";cc._RF.push(t,"ad93eoF2JtAnLaSo8UmrzRb","constants"),i.__esModule=!0,i.default=void 0,i.default={TABLE_SCALE:.42,TABLE_OFFSET_X:-15,TABLE_OFFSET_Y:0,TILE_WIDTH:86,TILE_HEIGHT:124,TILE_STACK_OFFSET_X:3,TILE_STACK_OFFSET_Y:16,TILE_OFFSET_X:2,TILE_OFFSET_TOP_Y:9,TILE_PER_TYPE:4,TILE_SEASON_THEME:["Spring","Summer","Autumn","Winter"],TILE_FLOWER_THEME:["Type1","Type2","Type3","Type4"],TILE_HIGHTLIGHT_COLOR:"#8EB7FF",RELATIVE_TOP_BLOCKING_TILES:[[0,0,1],[1,1,1],[1,-1,1],[-1,1,1],[-1,-1,1]],RELATIVE_LEFT_BLOCKING_TILES:[[-2,0,0],[-2,1,0],[-2,-1,0]],RELATIVE_RIGHT_BLOCKING_TILES:[[2,0,0],[2,1,0],[2,-1,0]]},t.exports=i.default,cc._RF.pop()},{}],helpers:[function(e,t){"use strict";cc._RF.push(t,"27317LYnohKlLhuyXz/wavH","helpers"),t.exports.getMappedKeyFromTile=function(e){return this.getMappedKeyFromPosition(e.position.x,e.position.y,e.position.z)},t.exports.getMappedKeyFromPosition=function(e,t,i){return e+"_"+t+"_"+i},cc._RF.pop()},{}]},{},["DataManager","IngameSceneCtor","LandingSceneCtor","helpers","Tile","constants"]);
//# sourceMappingURL=index.js.map
