window.__require=function e(t,i,o){function n(s,a){if(!i[s]){if(!t[s]){var r=s.split("/");if(r=r[r.length-1],!t[r]){var l="function"==typeof __require&&__require;if(!a&&l)return l(r,!0);if(c)return c(r,!0);throw new Error("Cannot find module '"+s+"'")}s=r}var p=i[s]={exports:{}};t[s][0].call(p.exports,function(e){return n(t[s][1][e]||e)},p,p.exports,e,t,i,o)}return i[s].exports}for(var c="function"==typeof __require&&__require,s=0;s<o.length;s++)n(o[s]);return n}({backdrop:[function(e,t){"use strict";cc._RF.push(t,"33979i+1ydJBLzksxkXWnGd","backdrop"),cc.Class({extends:cc.Component,properties:{sideWalls:[cc.Node],envNode:cc.Node,envTemplates:[cc.Prefab]},onLoad:function(){this.node.zIndex=-100},start:function(){this.env1=cc.instantiate(this.envTemplates[~~(Math.random()*this.envTemplates.length)]),this.env2=cc.instantiate(this.envTemplates[~~(Math.random()*this.envTemplates.length)]),this.env1.parent=this.envNode,this.env2.parent=this.envNode,this.env2.y=-600,this.envObjs=[this.env1,this.env2]},update:function(){},move:function(e){this.node.y-=e,this.sideWalls.forEach(function(t){t.y+=.5*e,t.y>600&&(t.y-=1200)});for(var t=0;t<2;t++){var i=this.envObjs[t];if(i.y+=.2*e,i.y>600){var o=i.y-1200;i.destroy(),this.envObjs[t]=cc.instantiate(this.envTemplates[~~(Math.random()*this.envTemplates.length)]),this.envObjs[t].parent=this.envNode,this.envObjs[t].y=o}}}}),cc._RF.pop()},{}],ball:[function(e,t){"use strict";cc._RF.push(t,"1f855lMJnZLjJf2bPQGKBbg","ball");var i=c(e("./pickup")),o=c(e("./spike")),n=c(e("./ingameCtor"));function c(e){return e&&e.__esModule?e:{default:e}}cc.Class({extends:cc.Component,properties:{controller:n.default,ballBodyPrefab:cc.Prefab,ballEyePrefab:cc.Prefab,normalSpriteFrame:cc.SpriteFrame,deadSpriteFrame:cc.SpriteFrame,bounceSpriteFrames:[cc.SpriteFrame]},onLoad:function(){var e=this;this.body=cc.instantiate(this.ballBodyPrefab),this.eye=cc.instantiate(this.ballEyePrefab),this.rigidBody=this.getComponent(cc.RigidBody),this.body.parent=this.node.parent,this.eye.parent=this.node.parent,this.lastY=0,this.bodyOffsetY=0,this.bounceTween=null,this.normalSpriteFrameSize=[this.normalSpriteFrame.getRect().width,this.normalSpriteFrame.getRect().height],this.deadSpriteFrameSize=[this.deadSpriteFrame.getRect().width,this.deadSpriteFrame.getRect().height],this.bounceSpriteFrameSizes=[],this.bounceSpriteFrames.forEach(function(t){e.bounceSpriteFrameSizes.push([t.getRect().width,t.getRect().height])})},start:function(){},lateUpdate:function(){var e=this,t=this.rigidBody.linearVelocity.y;if(this.lastY<0&&t>=0){var i=t;if(i>200){var o=.03/(.2*(this.controller.currentdifficultScale-1)+1);this.bounceTween&&this.bounceTween.stop(),this.bounceTween=cc.tween(this.node).call(function(){e.eye.active=!1,e.updateBodyBasedOnSpriteFrame(0,i/26/e.controller.currentdifficultScale)}).delay(o).call(function(){e.updateBodyBasedOnSpriteFrame(1,i/35/e.controller.currentdifficultScale)}).delay(1.4*o).call(function(){e.updateBodyBasedOnSpriteFrame(2,i/42/e.controller.currentdifficultScale)}).delay(1.8*o).call(function(){e.updateBodyBasedOnSpriteFrame(1,i/84/e.controller.currentdifficultScale)}).delay(2.4*o).call(function(){e.updateBodyBasedOnSpriteFrame(0)}).delay(2.8*o).call(function(){e.node.angle=0,e.eye.active=!0,e.updateBodyBasedOnSpriteFrame(-1)}).start()}}this.lastY=t,this.body.position=this.node.position,this.body.y-=this.bodyOffsetY,this.eye.position=this.node.position,this.eye.angle=this.node.angle},updateBodyBasedOnSpriteFrame:function(e,t){void 0===t&&(t=0),this.body.getComponent(cc.Sprite).spriteFrame=e<0?-2===e?this.deadSpriteFrame:this.normalSpriteFrame:this.bounceSpriteFrames[e];var i=e<0?-2===e?this.deadSpriteFrameSize:this.normalSpriteFrameSize:this.bounceSpriteFrameSizes[e];this.body.width=i[0],this.body.height=i[1],this.bodyOffsetY=this.normalSpriteFrameSize[1]-this.body.height+t},setDeadFrame:function(){this.eye.active=!1,this.updateBodyBasedOnSpriteFrame(-2)},onBeginContact:function(e,t,n){var c=n.getComponent(i.default);c&&this.controller.eatPickup(c.node);var s=n.getComponent(o.default);s&&this.controller.stumpSpike(s)}}),cc._RF.pop()},{"./ingameCtor":"ingameCtor","./pickup":"pickup","./spike":"spike"}],block:[function(e,t){"use strict";cc._RF.push(t,"dfa28y7x0BNFZQ9xARhs4Og","block"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.sprite=this.getComponent(cc.Sprite)},start:function(){},update:function(){}}),cc._RF.pop()},{}],ingameCtor:[function(e,t){"use strict";cc._RF.push(t,"f248dKnGNxJz51/88AFA/6x","ingameCtor");var i=n(e("./libs/perlin")),o=(n(e("./block")),n(e("./pickup")),n(e("./ingameUICtor")));function n(e){return e&&e.__esModule?e:{default:e}}cc.Class({extends:cc.Component,properties:{uiController:o.default,backdrop:cc.Node,ball:cc.Node,blockPrefab:cc.Prefab,pickup:cc.Prefab,spike:cc.Prefab,gameCamera:cc.Node},onLoad:function(){this.uiController.ingameController=this,cc.director.getPhysicsManager().enabled=!0,cc.director.getPhysicsManager().gravity=cc.v2(0,-1e3);var e=cc.director.getPhysicsManager();e.enabledAccumulator=!0,e.FIXED_TIME_STEP=1/30,e.VELOCITY_ITERATIONS=8,e.POSITION_ITERATIONS=8,cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this),this.isLeftPressed=!1,this.isRightPressed=!1,this.blocksPerRow=~~(this.node.width/40)-2,this.playingTime=0,this.score=0,this.currentdifficultScale=1,cc.director.isPaused&&cc.director.resume()},start:function(){var e=this;this.blockPool=new cc.NodePool("block"),this.pickupPool=new cc.NodePool("pickup"),this.spikePool=new cc.NodePool("spike"),this.blocks=[],this.pickups=[],this.spikes=[],i.default.seed(Math.random()),this.spawningBlockY=40,this.spawningBlockTime=0,this.spawnBlockRow([[!1,!1,!1,0],[!1,!1,!1,0],[!1,!1,!1,0],[!1,!1,!1,0],[!0,!1,!1,0],[!0,!1,!1,0],[!0,!1,!1,0],[!0,!1,!1,0],[!0,!1,!1,0],[!1,!1,!1,0],[!1,!1,!1,0],[!1,!1,!1,0],[!1,!1,!1,0]]),this.generateNewBlockRow(),this.uiController.updateScoreLabel(this.score),cc.director.pause(),this.uiController.popupOverlay.active=!0,setTimeout(function(){e.uiController.showReadyLabel()},300),setTimeout(function(){e.uiController.hideReadyLabel(),e.uiController.popupOverlay.active=!1},1800),setTimeout(function(){cc.director.resume()},2e3)},generateNewBlockRow:function(){for(;this.spawningBlockY>this.gameCamera.y-400;){for(var e=[],t=!1,o=0;!t&&o<10;){this.spawningBlockTime++;var n=!1,c=Math.random()<=.15,s=40*Math.random()-20,a=0,r=0;t=!0,o++,e=[];for(var l=0;l<this.blocksPerRow;l++){cc.log(this.spawningBlockTime%2*2-1);var p=i.default.simplex2(l,this.spawningBlockTime)*(this.spawningBlockTime%2*2-1)>-.1;p&&r>0&&r<2&&(p=!1),p?(r>0&&(c=Math.random()<=.15,s=40*Math.random()-20),r=0,a++):r++;var h=!!p&&Math.random()<=.1&&!n,u=!!p&&c;n|=h,e.push([p,h,u,s])}a>=this.blocksPerRow-5&&(t=!1)}this.spawnBlockRow(e)}},spawnBlockRow:function(e){var t=this;this.lastBlockRow=e;var i=-(this.blocksPerRow-1)/2;e.forEach(function(o){if(o[0]){var n=e.indexOf(o);if(t.blockPool.size()<=0){var c=cc.instantiate(t.blockPrefab);t.blockPool.put(c)}var s=t.blockPool.get();if(s.parent=t.node,s.position=cc.Vec3(40*(i+n),t.spawningBlockY+o[3]),s.getComponent(cc.PhysicsBoxCollider).restitution=Math.max(.6*(1-.05*.1*t.playingTime*.2),.5),s.getComponent(cc.PhysicsBoxCollider).apply(),t.blocks.push(s),o[1]){if(t.pickupPool.size()<=0){var a=cc.instantiate(t.pickup);t.pickupPool.put(a)}var r=t.pickupPool.get();r.parent=t.node,r.position=cc.Vec3(40*(i+n),t.spawningBlockY+o[3]+s.height/2+10+r.height/2),t.pickups.push(r)}else if(o[2]){if(t.spikePool.size()<=0){var l=cc.instantiate(t.spike);t.spikePool.put(l)}var p=t.spikePool.get();p.parent=t.node,p.position=cc.Vec3(40*(i+n),t.spawningBlockY+o[3]+s.height/2+p.height/2),t.spikes.push(p)}}}),this.spawningBlockY-=220},update:function(e){var t=this.ball.getComponent(cc.RigidBody);this.currentdifficultScale=1+.05*this.playingTime,this.isLeftPressed&&(t.linearVelocity=cc.v2(Math.min(t.linearVelocity.x,0),t.linearVelocity.y),t.angularVelocity=Math.min(t.angularVelocity,0),t.applyLinearImpulse(cc.v2(-15e3*e,0),t.getWorldCenter()),t.applyAngularImpulse(15e3*e)),this.isRightPressed&&(t.linearVelocity=cc.v2(Math.max(t.linearVelocity.x,0),t.linearVelocity.y),t.angularVelocity=Math.max(t.angularVelocity,0),t.applyLinearImpulse(cc.v2(15e3*e,0),t.getWorldCenter()),t.applyAngularImpulse(-15e3*e)),this.playingTime+=e;var i=50*e*this.currentdifficultScale;t.gravityScale=this.currentdifficultScale,this.gameCamera.y-=i,this.backdrop.getComponent("backdrop").move(i);for(var o=this.blocks.length-1;o>=0;o--){var n=this.blocks[o];n.position.y>this.gameCamera.y+400&&(this.blockPool.put(n),this.blocks.splice(o,1))}for(var c=this.pickups.length-1;c>=0;c--){var s=this.pickups[c];s.position.y>this.gameCamera.y+400&&(this.pickupPool.put(s),this.pickups.splice(c,1))}for(var a=this.spikes.length-1;a>=0;a--){var r=this.spikes[a];r.position.y>this.gameCamera.y+400&&(this.spikePool.put(r),this.spikes.splice(a,1))}this.generateNewBlockRow(),this.score+=10*e,this.uiController.updateScoreLabel(this.score)},lateUpdate:function(){Math.abs(this.ball.y-this.gameCamera.y)>400&&this.endGame();var e=this.ball.getComponent(cc.RigidBody);e.linearVelocity=cc.v2(e.linearVelocity.x/Math.abs(e.linearVelocity.x)*Math.min(Math.abs(e.linearVelocity.x),200),e.linearVelocity.y),this.isRightPressed||this.isLeftPressed||(e.linearVelocity=cc.v2(.8*e.linearVelocity.x,e.linearVelocity.y),e.angularVelocity=.9*e.angularVelocity)},eatPickup:function(e){this.pickupPool.put(e),this.pickups.splice(this.pickups.indexOf(e),1),this.score+=200,this.uiController.updateScoreLabel(this.score)},stumpSpike:function(){this.ball.getComponent("ball").setDeadFrame(),this.endGame()},pauseGame:function(){var e=this;cc.director.pause(),setTimeout(function(){e.uiController.showPopup("pause")},1e3)},endGame:function(){cc.director.pause(),this.uiController.showPopup("result")},resumeGame:function(){cc.director.resume(),this.uiController.hidePopup()},quitGame:function(){cc.director.loadScene("landing")},restartGame:function(){cc.director.loadScene("ingame")},onKeyDown:function(e){switch(e.keyCode){case cc.macro.KEY.left:case cc.macro.KEY.dpadLeft:this.isLeftPressed=!0;break;case cc.macro.KEY.right:case cc.macro.KEY.dpadRight:this.isRightPressed=!0}},onKeyUp:function(e){switch(e.keyCode){case cc.macro.KEY.left:case cc.macro.KEY.dpadLeft:this.isLeftPressed=!1;break;case cc.macro.KEY.right:case cc.macro.KEY.dpadRight:this.isRightPressed=!1}}}),cc._RF.pop()},{"./block":"block","./ingameUICtor":"ingameUICtor","./libs/perlin":"perlin","./pickup":"pickup"}],ingameUICtor:[function(e,t){"use strict";cc._RF.push(t,"7bb42GScFVC54uXdQ4eXL54","ingameUICtor"),cc.Class({extends:cc.Component,properties:{popupOverlay:cc.Node,resultPopup:cc.Node,pausePopup:cc.Node,readyLabel:cc.Node,scoreLabel:cc.Label},onLoad:function(){this.hideReadyLabel(),this.hidePopup()},start:function(){},hidePopup:function(){this.popupOverlay.active=!1,this.resultPopup.active=!1,this.pausePopup.active=!1},showPopup:function(e){switch(this.hidePopup(),this.popupOverlay.active=!0,e){case"pause":this.pausePopup.active=!0;break;case"result":this.resultPopup.active=!0}},hideReadyLabel:function(){this.readyLabel.active=!1},showReadyLabel:function(){this.readyLabel.active=!0},updateScoreLabel:function(e){this.scoreLabel.string=Math.round(e)},onResumeClicked:function(){this.ingameController.resumeGame(),this.hidePopup()},onPauseClicked:function(){this.ingameController.pauseGame()},onRestartClicked:function(){this.ingameController.restartGame()},onQuitClicked:function(){this.ingameController.quitGame()}}),cc._RF.pop()},{}],landingCtor:[function(e,t){"use strict";cc._RF.push(t,"ce4baYvJeFD6Jgwr6IrucOp","landingCtor"),cc.Class({extends:cc.Component,properties:{},start:function(){},onPlayClicked:function(){cc.director.loadScene("ingame")}}),cc._RF.pop()},{}],perlin:[function(e,t){"use strict";function i(e,t,i){this.x=e,this.y=t,this.z=i}cc._RF.push(t,"bd596Ss6v1BuIwW9SnsQQSk","perlin"),i.prototype.dot2=function(e,t){return this.x*e+this.y*t},i.prototype.dot3=function(e,t,i){return this.x*e+this.y*t+this.z*i};var o=[new i(1,1,0),new i(-1,1,0),new i(1,-1,0),new i(-1,-1,0),new i(1,0,1),new i(-1,0,1),new i(1,0,-1),new i(-1,0,-1),new i(0,1,1),new i(0,-1,1),new i(0,1,-1),new i(0,-1,-1)],n=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],c=new Array(512),s=new Array(512);t.exports.seed=function(e){e>0&&e<1&&(e*=65536),(e=Math.floor(e))<256&&(e|=e<<8);for(var t=0;t<256;t++){var i;i=1&t?n[t]^255&e:n[t]^e>>8&255,c[t]=c[t+256]=i,s[t]=s[t+256]=o[i%12]}},t.exports.seed(0);var a=.5*(Math.sqrt(3)-1),r=(3-Math.sqrt(3))/6;function l(e){return e*e*e*(e*(6*e-15)+10)}function p(e,t,i){return(1-i)*e+i*t}t.exports.simplex2=function(e,t){var i,o,n=(e+t)*a,l=Math.floor(e+n),p=Math.floor(t+n),h=(l+p)*r,u=e-l+h,d=t-p+h;u>d?(i=1,o=0):(i=0,o=1);var f=u-i+r,m=d-o+r,y=u-1+2*r,g=d-1+2*r,v=s[(l&=255)+c[p&=255]],b=s[l+i+c[p+o]],k=s[l+1+c[p+1]],C=.5-u*u-d*d,P=.5-f*f-m*m,w=.5-y*y-g*g;return 70*((C<0?0:(C*=C)*C*v.dot2(u,d))+(P<0?0:(P*=P)*P*b.dot2(f,m))+(w<0?0:(w*=w)*w*k.dot2(y,g)))},t.exports.simplex3=function(e,t,i){var o,n,a,r,l,p,h=(e+t+i)*(1/3),u=Math.floor(e+h),d=Math.floor(t+h),f=Math.floor(i+h),m=(u+d+f)*(1/6),y=e-u+m,g=t-d+m,v=i-f+m;y>=g?g>=v?(o=1,n=0,a=0,r=1,l=1,p=0):y>=v?(o=1,n=0,a=0,r=1,l=0,p=1):(o=0,n=0,a=1,r=1,l=0,p=1):g<v?(o=0,n=0,a=1,r=0,l=1,p=1):y<v?(o=0,n=1,a=0,r=0,l=1,p=1):(o=0,n=1,a=0,r=1,l=1,p=0);var b=y-o+1/6,k=g-n+1/6,C=v-a+1/6,P=y-r+1/6*2,w=g-l+1/6*2,S=v-p+1/6*2,F=y-1+.5,R=g-1+.5,B=v-1+.5,x=s[(u&=255)+c[(d&=255)+c[f&=255]]],M=s[u+o+c[d+n+c[f+a]]],_=s[u+r+c[d+l+c[f+p]]],T=s[u+1+c[d+1+c[f+1]]],L=.6-y*y-g*g-v*v,O=.6-b*b-k*k-C*C,E=.6-P*P-w*w-S*S,V=.6-F*F-R*R-B*B;return 32*((L<0?0:(L*=L)*L*x.dot3(y,g,v))+(O<0?0:(O*=O)*O*M.dot3(b,k,C))+(E<0?0:(E*=E)*E*_.dot3(P,w,S))+(V<0?0:(V*=V)*V*T.dot3(F,R,B)))},t.exports.perlin2=function(e,t){var i=Math.floor(e),o=Math.floor(t);e-=i,t-=o;var n=s[(i&=255)+c[o&=255]].dot2(e,t),a=s[i+c[o+1]].dot2(e,t-1),r=s[i+1+c[o]].dot2(e-1,t),h=s[i+1+c[o+1]].dot2(e-1,t-1),u=l(e);return p(p(n,r,u),p(a,h,u),l(t))},t.exports.perlin3=function(e,t,i){var o=Math.floor(e),n=Math.floor(t),a=Math.floor(i);e-=o,t-=n,i-=a;var r=s[(o&=255)+c[(n&=255)+c[a&=255]]].dot3(e,t,i),h=s[o+c[n+c[a+1]]].dot3(e,t,i-1),u=s[o+c[n+1+c[a]]].dot3(e,t-1,i),d=s[o+c[n+1+c[a+1]]].dot3(e,t-1,i-1),f=s[o+1+c[n+c[a]]].dot3(e-1,t,i),m=s[o+1+c[n+c[a+1]]].dot3(e-1,t,i-1),y=s[o+1+c[n+1+c[a]]].dot3(e-1,t-1,i),g=s[o+1+c[n+1+c[a+1]]].dot3(e-1,t-1,i-1),v=l(e),b=l(t),k=l(i);return p(p(p(r,f,v),p(h,m,v),k),p(p(u,y,v),p(d,g,v),k),b)},cc._RF.pop()},{}],pickup:[function(e,t){"use strict";cc._RF.push(t,"b13ff37Sp5LU6CvtWX6uTD8","pickup"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){},start:function(){},setType:function(){},update:function(){}}),cc._RF.pop()},{}],spike:[function(e,t){"use strict";cc._RF.push(t,"6d884VdxFVHp4E6MFk25Cm0","spike"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.node.zIndex=-10},start:function(){},setType:function(){},update:function(){}}),cc._RF.pop()},{}]},{},["backdrop","ball","block","ingameCtor","ingameUICtor","landingCtor","perlin","pickup","spike"]);